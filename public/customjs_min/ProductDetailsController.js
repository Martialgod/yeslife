angular.module("app",["AppServices"]).constant("API_URL","/mail").config(["$httpProvider",function(o){o.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).controller("ProductDetailsController",["$http","SQLSTATEFactory","API_URL","GlobalFactory",function(o,t,r,e){var s=this;s.pk_products=$("#productid").val(),s.fk_productgroup=$("#productgroup").val(),s.search=null,s.mscproducts=[],s.currentproduct={},s.selectedflavor=s.pk_products,s.mscflavors=[],s.mscreviews=[],s.totalreviews=0,s.navlinks={},s.meta={},s.ShowProduct=function(t){t=t||s.pk_products,showCustomizeLoadingNoIcon(),o.get("/apishowproduct/"+t).then(function(o){var t=o.data;"not found"!=t?(s.currentproduct=t.products,s.mscflavors=t.flavors):s.currentproduct={},e.unblockUICustom("#main-div")},function(o){swal("Opps!","Something went wrong!","error"),console.log(o.data),e.unblockUICustom("#main-div")})},s.StringifyStars=function(){s.currentproduct.stars_string="";for(var o=1;o<=s.currentproduct.ratings2;o++)s.currentproduct.stars_string+='<i class="fa fa-star"></i>'},s.AddToCart=function(o){if(null!=s.selectedflavor){var t={productid:o.pk_products,qty:1};addCartCookie(t),toastr_item_added_to_cart()}else toastr.error("Please select a flavor")},s.GlobalBuyNow=function(o){null!=s.selectedflavor?GlobalBuyNow(o.pk_products,1):toastr.error("Please select a flavor")},s.LoadReviews=function(t){t=t||"/shop/"+s.fk_productgroup+"/reviews?v="+Math.random(),s.mscreviews=[],o.get(t).then(function(o){var t=o.data;s.navlinks=t.links,s.meta=t.meta,s.mscreviews=t.data,s.StringifyStars()},function(o){swal("Opps!","Something went wrong!","error"),console.log(o.data)})},s.PostReviews=function(t){t.preventDefault(),$("#form-reviews").valid()&&(showCustomizeLoading(),o.post("/shop/"+s.pk_products+"/reviews",$("#form-reviews").serializeArray()).then(function(o){var t=o.data;s.navlinks=t.links,s.meta=t.meta,s.mscreviews=t.data,s.StringifyStars(),hideCustomizeLoading(),$("#comments").val(""),swal("Success","Your review has been posted!","success")},function(o){console.log(o),swal("Opps!","Errors found! <br> Please see logs","error"),hideCustomizeLoading()}))},s.SearchProducts=function(t){t=t||"/shop-search",showCustomizeLoadingNoIcon(),s.mscproducts=[],o.post(t,{search:s.search}).then(function(o){var t=o.data;$("#searchresultbody").html(""),s.mscproducts=t.data,e.unblockUICustom("#main-div")},function(o){swal("Opps!","Something went wrong!","error"),console.log(o.data),e.unblockUICustom("#main-div")})},showCustomizeLoadingNoIcon(),setTimeout(function(){s.ShowProduct()},500)}]);