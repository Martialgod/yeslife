angular.module("app",["AppServices"]).constant("API_URL","/products").config(["$httpProvider",function(o){o.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).controller("ProductCompositionsController",["$http","SQLSTATEFactory","API_URL","GlobalFactory",function(o,t,s,i){var n=this;n.search=null,n.pk_products=$("#pk_products").val(),n.searchitems=[],n.compositions=[],i.blockUICustom("#main-div"),setTimeout(function(){o.get("/admin/products/"+n.pk_products+"/compositions?"+Math.random()).then(function(o){var t=o.data;n.searchitems=t.searchitems,n.compositions=t.compositions,i.unblockUICustom("#main-div")},function(o){swal("Opps!","Something went wrong!","error"),console.log(o.data),i.unblockUICustom("#main-div")})},1e3),n.Search=function(){n.searchitems=[],i.blockUICustom("#main-div"),o.get("/admin/products/"+n.pk_products+"/compositions-search?search="+n.search,{}).then(function(o){var t=o.data;n.searchitems=t,i.unblockUICustom("#main-div")},function(o){swal("Opps!","Something went wrong!","error"),console.log(o.data),i.unblockUICustom("#main-div")})},n.isNumber=function(o,t){switch(t){case"qty":isNaN(o.qty)&&(o.qty=1),parseFloat(o.qty)<=0&&(o.qty=1),o.qty=parseFloat(o.qty)}},n.RemoveCompositions=function(o){n.compositions.forEach(function(t,s){o.fk_compositions==t.fk_compositions&&n.compositions.splice(s,1)})},n.AddCompositions=function(o){var t=!1;n.compositions.forEach(function(s,i){o.pk_products==s.fk_compositions&&(s.qty=parseFloat(s.qty)+1,t=!0)}),t||n.compositions.push({fk_compositions:o.pk_products,qty:1,name:o.name,pictxa:o.pictxa})},n.SubmitCompositions=function(){i.blockUICustom("#main-div"),o.post("/admin/products/"+n.pk_products+"/compositions",{compositions:n.compositions}).then(function(o){o.data,swal("Success!","Product compositions updated!","success"),i.unblockUICustom("#main-div")},function(o){swal("Opps!","Something went wrong!","error"),console.log(o.data),i.unblockUICustom("#main-div")})}}]);