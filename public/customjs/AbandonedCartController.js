angular.module("app",["AppServices"]).constant("API_URL","/abandonedcart").config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).controller("AbandonedCartController",["$http","SQLSTATEFactory","API_URL","GlobalFactory",function(e,t,o,n){var a=this;a.customers=[],a.SendMail=function(){n.blockUICustom("#main-div"),a.executioncounter=0;var t=function(){e.post("/admin/abandonedcart/broadcast",{customers:a.customers[a.executioncounter]}).then(function(e){var o=e.data;console.log(o);var r=a.customers[a.executioncounter].userid;if($("#"+r+"stat").html("Sent.."),a.executioncounter++,!(a.executioncounter<a.customers.length))return n.unblockUICustom("#main-div"),void(location.href="/admin/abandonedcart");setTimeout(function(){t()},1e3)},function(e){swal("Opps!","Something went wrong!","error"),console.log(e.data),n.unblockUICustom("#main-div")})};t()},$("#form-broadcast").submit(function(e){e.preventDefault();var t=$("#form-broadcast").serializeArray();a.customers=[],t.forEach(function(e,t){-1!==e.name.indexOf("users_")&&(tempid=e.name.replace("users_",""),a.customers.push({userid:tempid,email:e.value,fullname:$("#fullname"+tempid).val()}))}),a.customers.length>0?a.SendMail():swal("Opps!","No more customers to broadcast!","info")})}]);