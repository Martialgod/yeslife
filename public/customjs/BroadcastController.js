angular.module("app",["AppServices"]).constant("API_URL","/mail").config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).controller("BroadcastController",["$http","SQLSTATEFactory","API_URL","GlobalFactory",function(e,t,o,r){var n=this;n.pk_ordermstr=$("#pk_ordermstr").val(),n.customers=[],n.SendMail=function(){r.blockUICustom("#main-div"),n.executioncounter=0;var t=function(){e.post("/admin/orders/"+n.pk_ordermstr+"/broadcast",{customers:n.customers[n.executioncounter]}).then(function(e){e.data;var o=n.customers[n.executioncounter].userid;if($("#"+o+"stat").html("Sent.."),n.executioncounter++,!(n.executioncounter<n.customers.length))return r.unblockUICustom("#main-div"),void(location.href="/admin/orders/"+n.pk_ordermstr+"/broadcast");setTimeout(function(){t()},1e3)},function(e){swal("Opps!","Something went wrong!","error"),console.log(e.data),r.unblockUICustom("#main-div")})};t()},$("#form-broadcast").submit(function(e){e.preventDefault();var t=$("#form-broadcast").serializeArray();n.customers=[],t.forEach(function(e,t){-1!==e.name.indexOf("users_")&&(tempid=e.name.replace("users_",""),n.customers.push({userid:tempid,email:e.value,fullname:$("#fullname"+tempid).val()}))}),n.customers.length>0?n.SendMail():swal("Opps!","No more customers to broadcast!","info")})}]);